<div class="d-flex justify-content-center" *ngIf="!cargando">
  <div class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
</div>

<div class="container-fluid" *ngIf="cargando && !cargosExtr">
  <div class="row">
    <div *ngIf="rol < 3" class="row">
      <div class="col-lg-6 col-sm-12 col-md-6">
        <div class="card" *ngIf="statusInscri">
          <div class="bodyCamper">
            <h1 style="color:white;">{{textos[idoma]["texto11"]}}</h1>
          </div>
          <div class="mt-5px container-pagos p-2" *ngIf="pagos">
            <h1>{{textos[idoma]["texto12"]}} {{  balance | number:'1.0-0'   }}
            </h1>
          </div>
          <div class="col-lg-12">
            <div class="card p-2">
              <div class="card-body">

                <p class="card-title-title" style="color: rgb(226, 77, 77);" *ngIf="dataCamp.show_payment_order">
                  {{textos[idoma]["texto13"]}}
                </p>

                <div *ngIf="rol == 1">
                  <div class="table-responsive" *ngIf="pagos && dataCamp.show_payment_parent">
                    <table class="table mb-0">
                      <thead class="thead-dark">
                        <tr>
                          <th>#</th>
                          <th>{{textos[idoma]["th"]}}</th>
                          <th>{{textos[idoma]["th1"]}}</th>
                          <th>{{textos[idoma]["th2"]}}</th>
                          <th>{{textos[idoma]["th3"]}}</th>
                          <th>{{textos[idoma]["th4"]}}</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of dataPagos">
                          <td>{{item.id}}</td>
                          <td>{{item.payment_date.substring(0,10)}}</td>
                          <td>{{item.txn_number}}</td>
                          <td>
                        
                              {{item.charge}} 
                           
                           
                          </td>
                          <td>
                             {{item.pay}} 
                            
                          </td>
                          <td>{{item.balance}} </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div *ngIf="rol == 2">
                  <p-tabView>
                    <p-tabPanel [header]="textos[idoma]['textoTabPagos']">
                      <div class="table-responsive">
                        <table class="table mb-0">
                          <thead class="thead-dark">
                            <tr>
                              <th>#</th>
                              <th>{{textos[idoma]['th']}}</th>
                              <th>{{textos[idoma]['th1']}}</th>
                              <th>{{textos[idoma]['th2']}}</th>
                              <th>{{textos[idoma]['th3']}}</th>
                              <th>{{textos[idoma]['th4']}}</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let item of dataPagos">
                              <tr *ngFor="let item of dataPagos">
                                <td>{{item.id}}</td>
                                <td>{{item.payment_date.substring(0,10)}}</td>
                                <td>{{item.txn_number}}</td>
                                <td>
                              
                                    {{item.charge}} 
                                 
                                 
                                </td>
                                <td>
                                   {{item.pay}} 
                                  
                                </td>
                                <td>{{item.balance}} </td>
                              </tr>
                            
                          </tbody>
                        </table>
                      </div>
                    </p-tabPanel>
                    <p-tabPanel [header]="textos[idoma]['textoTabPagosMp']">
                      <table class="table table-bordered table-striped" *ngIf="dataCamp.show_mercadopago_button">
                        <thead>
                          <tr>
                            <th>{{textos[idoma]['texto16']}}</th>
                            <th>{{textos[idoma]['texto17']}}</th>
                            <th>{{textos[idoma]['texto18']}}</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let payment of paymentsMp">
                            <td>{{ payment.additional_info.items[0]?.description }}</td>
            <td>{{ payment.date_created | date: 'dd/MM/yyyy HH:mm:ss' }}</td>
            <td [ngClass]="getStatusClass(payment.status)">
              {{ mapStatus(payment.status) }}
            </td>
                          </tr>
                        </tbody>
                      </table>
                    </p-tabPanel>
                  </p-tabView>
                </div>

                <div *ngIf="!pagos">
                  <div class="alert alert-success" role="alert">
                    {{textos[idoma]['texto14']}}
                  </div>
                </div>

                <div *ngIf="dataCamp.show_payment_order" class="d-flex justify-content-center">
                  <button class="btn btn-success p-2" style="width:70%;" (click)="getBaucher()" *ngIf="dataCamp.show_payment_parent">
                    {{textos[idoma]['texto41']}}
                  </button>
                </div>

                <div *ngIf="dataCamp.show_mercadopago_button" class="d-flex flex-column align-items-center">
                  <p class="fs-5">{{textos[idoma]['texto19']}}</p>
                  <div class="alert alert-info w-100" role="alert">
                    <h4 class="alert-heading">{{textos[idoma]['texto20']}}</h4>
                    <p>{{textos[idoma]['texto21']}}</p>
                    <ul>
                      <li *ngFor="let metodo of textos[idoma].listaMp">{{metodo}}</li>
                    </ul>
                    <hr>
                    <p class="mb-0">{{textos[idoma]['texto22']}}</p>
                  </div>
                  <a class="mercado-pago-btn" (click)="showMercadopago=!showMercadopago">
                    <img src="https://img.icons8.com/?size=100&id=nTLVtpxsNPaz&format=png&color=000000" height="25px"> {{textos[idoma]['textoClickAqui']}}
                  </a>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 col-sm-12 col-md-6">
        <div class="card" *ngIf="statusInscri">
          <div class="bodyCamper2">
            <h3 style="color:white;" class="mt-2">{{textos[idoma]['texto15']}}</h3>
          </div>
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-bordered table-striped mb-0">
                  <thead>
                    <tr>
                      <th>{{textos[idoma]['th']}}</th>
                      <th>Cantidad a pagar</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of fechadePagos">
                      <td>{{item.name | date:'dd MMMM yyyy'}}</td>
                      <td>{{item.price | currency:'USD':'':'1.2-2'}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="col-lg-12">
      <div class="card p-2">
        <div class="bodyCamper1">
          <h1 style="color:white;">{{textos[idoma]['titulo']}} {{dataCamp.name}}</h1>
        </div>
        <div class="mt-3 ms-3 container-pagos">
          <h1>{{dataCamp.name}}</h1>
        </div>
        <hr>
        <div class="card">
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="fas fa-calendar-alt"></i> {{textos[idoma]['texto1']}}</p>
            <p>{{dataCamp.start | date:'yyyy-MM-dd'}} - {{dataCamp.end | date:'yyyy-MM-dd'}}</p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="bx bxs-time"></i> {{textos[idoma]['texto2']}}</p>
            <p>{{dataCamp.start | date:'HH:mm'}}</p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="bx bxs-time"></i> {{textos[idoma]['texto3']}}</p>
            <p>{{dataCamp.end | date:'HH:mm'}}</p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="fas fa-map-marked-alt"></i> {{textos[idoma]['texto4']}}</p>
            <p>{{dataCamp.venue}}</p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="fas fa-map"></i> {{textos[idoma]['texto5']}}</p>
            <p>{{location}}</p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="fas fa-map"></i> {{textos[idoma]['texto8']}}</p>
            <p>{{dataCamp.insurance}}</p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="bx bxs-camera-plus"></i> {{textos[idoma]['texto10']}}</p>
            <p><a href="{{dataCamp.photo_url}}">{{textos[idoma]['texto10']}}</a></p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="bx bx-globe"></i> {{textos[idoma]['texto6']}}</p>
            <p><a href="{{dataCamp.url}}">{{dataCamp.url}}</a></p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="bx bx-key"></i> {{textos[idoma]['texto7']}}</p>
            <p>{{dataCamp.photo_password}}</p>
          </div>
          <div class="conatiner-info-camp">
            <p class="fw-bold"><i class="bx bx-key"></i> {{textos[idoma]['texto42']}}</p>
            <p>{{removeHtmlTags(dataCamp.special_message)}}</p>
          </div>
          <div class="conatiner-info-camp" *ngIf="dataCamp.show_paypal_button">
            <p class="fw-bold"><i class="bxl-paypal"></i> Paypal</p>
            <p><a href="{{dataCamp.paypal_button}}">Paypal</a></p>
          </div>
          <div class="conatiner-info-camp" *ngIf="dataCamp.show_mercadopago_button">
            <p class="fw-bold"><i><img src="https://img.icons8.com/?size=100&id=nTLVtpxsNPaz&format=png&color=000000" height="25px"/></i> Mercado Pago</p>
            <p><a (click)="showMercadopago=!showMercadopago">{{textos[idoma]['texto20']}}</a></p>
          </div>
        </div>
        <hr>
        <div class="conatiner-info-camp" *ngIf="dataCamp.show_payment_parent">
          <p class="fw-bold"><i class="far fa-money-bill-alt"></i>{{textos[idoma]['texto9']}}</p>
          <p>${{dataCamp.public_price}} MXN.</p>
        </div>
        <div class="container-btn">
          <button class="btn btn-info p-2" style="height:60px;" (click)="incio()">{{textos[idoma]['texto32']}}</button>
          <button class="btn btn-secondary p-2" style="height:60px;" (click)="perfil()">{{textos[idoma]['texto33']}}</button>
          <button class="btn btn-success p-2" style="height:60px;" (click)="inscribirCamps()" *ngIf="!statusInscri">{{textos[idoma]['texto34']}}</button>
          <button class="btn btn-success p-2" style="height:60px;" (click)="open(content)" *ngIf="statusInscri">{{textos[idoma]['texto35']}}</button>
          <button class="btn btn-info p-2" style="height:60px;" (click)="open(content2)" *ngIf="statusInscri">{{textos[idoma]['texto36']}}</button>
          <button class="btn btn-danger p-2" style="height:60px;" (click)="showCancelDialog=!showCancelDialog" *ngIf="statusInscri">{{textos[idoma]['texto37']}}</button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-update-perfil *ngIf="cargando && cargosExtr" [typeSucribe]="typeSucribe" (inscribirCamps)="suscribeCamps($event)"></app-update-perfil>

<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">{{textos[idoma]['texto29']}}</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <div class="mb-3" *ngFor="let item of PreguntasExtras; let a = index">
      <label for="dateOfBirth">{{item.question}}</label>
      <div class="input-group">
        <input class="form-control" type="text" [(ngModel)]="PreguntasExtras[a].answer" name="answer" />
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-outline-dark" (click)="saveRes()" *ngIf="!spinner">{{textos[idoma]['texto31']}}</button>
    <div class="spinner-border" role="status" *ngIf="spinner"><span class="sr-only">Loading...</span></div>
  </div>
</ng-template>

<ng-template #content2 let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">{{textos[idoma]['texto30']}}</h4>
    <button class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <div class="mb-3" *ngFor="let item of cargosExtras; let index = index;">
      <label for="dateOfBirth">{{item.extra_charge_name}}</label>
      <input class="form-check-input" type="checkbox" [(ngModel)]="cargosExtras[index].extra_selected" />
      <label class="form-check-label">${{item.extra_charge_price}}</label>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-outline-dark" (click)="saveChange()" *ngIf="!spinner">{{textos[idoma]['texto31']}}</button>
    <div class="spinner-border" role="status" *ngIf="spinner"><span class="sr-only">Loading...</span></div>
  </div>
</ng-template>

<p-dialog [(visible)]="showMercadopago" [modal]="true" [style]="{width:'90vw'}" [draggable]="false" [resizable]="false" [responsiveOptions]="dialogResponsiveOptions">
  <div class="container-fluid">
    <div class="card col-12 border border-info border-1">
      <div class="bg-info p-2">
        <h1 class="card-title text-white">{{textos[idoma]['textoMercadoTitulo']}}</h1>
      </div>
      <div class="alert alert-warning col-12" role="alert">
        {{textos[idoma]['texto38']}} {{balance | currency}}. {{textos[idoma]['texto39']}}
      </div>
      <div class="text-center mb-3">
        <input type="number" class="form-control w-50 mx-auto" [(ngModel)]="pagoMercado" />
      </div>
      <div class="table-responsive mb-3">
        <table class="table table-bordered table-striped mb-0">
          <thead><tr><th>{{textos[idoma]['th']}}</th><th>{{textos[idoma]['textoCantidadPagar']}}</th></tr></thead>
          <tbody><tr *ngFor="let item of fechadePagos"><td>{{item.name | date:'dd MMMM yyyy'}}</td><td>{{item.price | currency:'USD':'':'1.2-2'}}</td></tr></tbody>
        </table>
      </div>
      <button class="btn btn-warning w-50 mx-auto" (click)="linkMp()">{{textos[idoma]['texto40']}}</button>
    </div>
  </div>
</p-dialog>

<p-dialog [(visible)]="showCancelDialog" [modal]="true" [style]="{width:'50vw'}" [draggable]="false" [resizable]="false" [responsiveOptions]="dialogResponsiveOptions" [closable]="false">
  <div class="card border-danger">
    <div class="bg-danger p-2 text-center">
      <h1 class="text-white">{{textos[idoma]['texto23']}}</h1>
    </div>
    <div class="alert alert-warning text-center mb-3">
      {{textos[idoma]['texto24']}}
    </div>
    <div class="text-center">
      <p>{{textos[idoma]['texto25']}}</p>
      <button class="btn btn-danger me-2" (click)="deletCamp()">{{textos[idoma]['texto26']}}</button>
      <button class="btn btn-secondary" (click)="showCancelDialog=false">{{textos[idoma]['texto27']}}</button>
    </div>
  </div>
</p-dialog>
