<div class="container-fluid">
    <div class="row">
        <div class="col-lg-3">
            <div class="d-grid gap-2 col-12 mx-auto">
                <button class="btn btn-primary" (click)="status('Enviar Correo')">Enviar Correo</button>
                <button class="btn btn-primary" (click)="status('Nuevo Templates')">Crear Templates</button>

                <ul class="list-group  mt-3">
                    <li class="list-group-item list-group-item-action" (click)="status('Plantillas')" style="cursor: pointer;"> <i
                            class="fas fa-ad fas fa-envelope-open-text"></i> Templates</li>
                    <li class="list-group-item list-group-item-action" (click)="status('Plantillas del sistemas')"  style="cursor: pointer;"> <i
                            class="fas fa-ad fas fa-envelope-open-text"></i> Templates sistemas</li>
                            <li class="list-group-item list-group-item-action" (click)="status('Correos enviados')"  style="cursor: pointer;"> <i
                                class="fas fa-ad fas fa-envelope-open-text"></i> Correos enviados</li>
                </ul>

            </div>

        </div>


        <div class="col-lg-9">



            <div class="card border-top border-primary" *ngIf="!editTemplate">
                <h1 class="mt-4 container-fluid">{{Titulo}}</h1>
                <div>
                    <div class="row">
                        <div class="col-12">
                            <div class="card" *ngIf="Titulo !='Nuevo Templates' &&  Titulo != 'Enviar Correo'">
                                <div class="card-body">
                                    <div class="row mb-2">

                                        <div>
                                            <div class="card border border-info border-1" >
                                                <div class="bg-info p-2">
                                                </div>
                                                <div class="card-body">
                                                    <div class="container-btn mt-1 mb-3">

                                                      
                                                    </div>
                                                    <div style="overflow: auto;">
                                                        <p-table #dt [value]="listaTemplates" [rows]="10"
                                                            [globalFilterFields]="['title','name','email','contact_second_email','contact_third_name','acronyms']"
                                                            [(selection)]="selectCatalogos" [rowHover]="true"
                                                            dataKey="id"
                                                            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                                                            [showCurrentPageReport]="true"
                                                            *ngIf="!cargando">

                                                            <ng-template pTemplate="header">
                                                                <tr>
                                                                    <th pSortableColumn="name">Nombre<p-sortIcon
                                                                            field="title"
                                                                            style="font-size: 10px;"></p-sortIcon></th>
                                                               
                                                                </tr>
                                                            </ng-template>
                                                            <ng-template pTemplate="body" let-customer  >
                                                                <tr >
                                                                    <td (click)="selectUpadate(customer)"  style="cursor: pointer;">
                                                                        {{customer.title}}
                                                                    </td>
                                                                 
                                                                </tr>
                                                              
                                                            </ng-template>
                                                            
                                                        </p-table>
                                                        <div class="d-flex justify-content-center" *ngIf="cargando">
                                                            <div class="spinner-border" role="status">
                                                              <span class="visually-hidden">Loading...</span>
                                                            </div>
                                                          </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col" *ngIf="Titulo ==='Nuevo Templates'">
                    <hr>
                    <div class="mx-auto container">
                        <div class="row">
                            <h2>Editar Template</h2>

                            <div class="col-lg-12  mt-4" >
                                <p>Tipo de Template</p>

                                <select name="" id="" [(ngModel)]="typetemplate" style="width: 100%;"
                                    class="form-select mt-2">
                                    <option   value="1">Template </option>
                                    <option   value="2">Template del sistema </option>


                                    
                                </select>
                            </div>
                        
                        </div>
                    </div>
                    <div class="mx-auto container">
                        <div class="row">
                          

                            <div class="col-lg-12  mt-4" *ngIf="typetemplate==2">
                                <p>Tipo de plantilla</p>

                                <select name="" id="" [(ngModel)]="tipoTemplate" style="width: 100%;"
                                    class="form-select mt-2">
                                     <option  *ngFor="let item of tiposTemplates" [value]="item.id">{{item.value}}</option>
                                    
                                </select>
                            </div>
                            <div class="col-lg-12 mt-4">
                                <input type="text" placeholder="Titulo" class="form-control"  [(ngModel)]="tituloTempalet">
                            </div>
                            

                        </div>
                    </div>

                    <div class="mt-4 col-12">
                        <ckeditor [editor]="Editor" [(ngModel)]="template" >
                        </ckeditor>

                    </div>
                    <div class="alert alert-primary" role="alert" *ngIf="statusRes">
                       Se agrego correctamente
                    </div>

                    <div class="alert alert-danger" role="alert" *ngIf="statuserror">
                        No se pudo agregar correctamente
                      </div>


                    <div class="btn-container">
                        <button class="btn btn-primary" style="width: 100%;" (click)="cretateTemplaet()" *ngIf="!showSpiner">Guardar</button>
                        <div class="spinner-border" role="status" *ngIf="showSpiner">
                            
                          </div>
                    </div>

                </div>


                <div class="col container-fluid " *ngIf="Titulo ==='Enviar Correo'">
                    <hr>
                    <div class="mx-auto" *ngIf="page==1">
                        <div class="row">
                            <div class="col-lg-12">
                                <p>Dirigido a </p>

                                <select name="" id="" [(ngModel)]="tipoTemplate" style="width: 100%;"
                                    class="form-select mt-2" (change)="cambios()">
                                    <option value="1">Participante de un solo campamente </option>
                                  <!-- <option value="2">Participante de una capacitacion</option> -->  
                                    <option value="3">Participante de Varios Campamentos</option>
                                   <!-- <option value="4">Prospectos de una temporada </option> --> 
                                </select>
                            </div>
                            <div *ngIf="tipoTemplate == 1" >
                                <div class="col-lg-12 mt-2">
                                    <p>Seleciona el Campamento</p>
                                    <ng-select name="" id="" [(ngModel)]="campamento" style="width: 100%;"  (change)="refresh()"
                                        class=" mt-2">
                                        <ng-option *ngFor="let item of listaCampamentos" [value]="item.id">{{item.name}}</ng-option>
                                    </ng-select>
                                </div>
                                <div  class="col-lg-12 mt-2">
                                    <p>Publico Objetivo</p>
                                    <ng-select name="" id="" [(ngModel)]="publicoSelecionado" style="width: 100%;" (change)="selectDestino()"
                                        class="mt-2" [multiple]="true">
                                        <ng-option *ngFor="let obj of publico" [value]="obj.value">{{obj.publico}}
                                        </ng-option>
                                    </ng-select>
                                </div>
                            </div>
                            <div *ngIf="tipoTemplate == 4" >
                                
                                <div  class="col-lg-12 mt-2">
                                    <p>Seleciona temporada</p>
                                    <ng-select name="" id="" [(ngModel)]="selectTemporada" style="width: 100%;" (change)="selectProspectos()"
                                        class="mt-2" >
                                        <ng-option *ngFor="let obj of temporada" [value]="obj.id">{{obj.name}}
                                        </ng-option>
                                    </ng-select>
                                </div>
                            </div>

                            <div *ngIf="tipoTemplate == 3" >
                                <div class="col-lg-12 mt-2">
                                    <p>Seleciona el Campamento</p>
                                    <ng-select name="" id="" [(ngModel)]="listCamp" style="width: 100%;" (change)="selectDestinoMultiplesCamps()"
                                    class="mt-2" [multiple]="true">
                                    <ng-option *ngFor="let item of listaCampamentos" [value]="item.id">{{item.name}}</ng-option>
                                </ng-select>
                                </div>
                            </div>

                            <div *ngIf="tipoTemplate == 2" >
                                <div class="col-lg-12 mt-2">
                                    <p>Seleciona la Capacitaci√≥n</p>
                                    <ng-select name="" id="" [(ngModel)]="selectCapacitacion" style="width: 100%;" (change)="selectCapacitaciones()"
                                    class="mt-2" [multiple]="false">
                                    <ng-option *ngFor="let item of listaCapacitaciones" [value]="item.TrainingEvent.id">{{item.name}}</ng-option>
                                </ng-select>
                                </div>
                            </div>
                           


                           


                        </div>
                    </div>

                    <div class="mt-4" *ngIf="page==2">
                         
                        <div class="col-lg-12 mt-3 form-grup">
                            <button class="btn btn-primary" (click)="displayMaximizable = true" style="margin: 0 auto; width: 100%;">Elegir destinatarios</button>
                            <div  class="col-lg-12 mt-3 form-grup">
                                <label for="">Nombre interno del correo:</label>

                                <input type="text" name="" class="form-control" id="" [(ngModel)]="tituloTemplateAlmacenado" placeholder="Asunto">

                            </div>
                            <div  class="col-lg-12 mt-3 form-grup">
                                <label for="">Template almacenado :</label>
                                <ng-select name="" id="" [(ngModel)]="templateAlmacenado" style="width: 100%;" (change)="selectTemplate()"
                                    [multiple]="false">

                                    <ng-option *ngFor="let item of listaTemplateAlmacenado" [value]="item.id"> {{item.title}}</ng-option>
                                </ng-select>
                            </div>
                            <div  class="col-lg-12 mt-3 form-grup">
                                <label for="">Asunto :</label>

                                <input type="text" name="" class="form-control" id="" [(ngModel)]="asuntoTemplateAlmacenado" placeholder="Asunto">

                            </div>


                        </div>
                        <ckeditor [editor]="Editor" [(ngModel)]="template" >
                        </ckeditor>

                    </div>

                    <div class="btn-container mt-2 mb-2" *ngIf="page==1">
                        <button class="btn btn-primary" >Cancelar</button>

                        <button class="btn btn-primary" (click)="seguiente()" [disabled]="!botonDisiable">Siguente</button>

                    </div>


                    <div class="btn-container mt-2 mb-2" *ngIf="page==2">
                        <button class="btn btn-primary" (click)="atras()">Atras</button>
                       <div>
                        <div class="spinner-border text-primary" role="status"  *ngIf="cargandoMailing">
                          </div>
                        <button class="btn btn-primary" (click)="createEmail()"  *ngIf="!cargandoMailing">Enviar</button>

                       </div>

                    </div>

                </div>
            </div>

            
            <div class="card border-top border-primary" *ngIf="editTemplate">
             
                <h1 class="mt-3">Editar template</h1>
                <div class="col" >
                    <hr>
                    <div class="mx-auto container">
                        <div class="row">
                          

                            <div class="col-lg-12  mt-4" >
                                <p>Tipo de Template</p>

                                <select name="" id="" [(ngModel)]="typetemplate" style="width: 100%;"
                                    class="form-select mt-2">
                                    <option   value="1">Template </option>
                                    <option   value="2">Template del sistema </option>


                                    
                                </select>
                            </div>
                        
                        </div>
                    </div>
                    <form action="" [formGroup]="updateTemplate">
                        <div class="mx-auto container">
                            <div class="row">
                              
    
                                <div class="col-lg-12  mt-4" *ngIf="typetemplate==2">
                                    <p>Tipo de plantilla</p>
    
                                    <select name="" id=""  style="width: 100%;" formControlName="template_type"
                                        class="form-select mt-2">
                                         <option  *ngFor="let item of tiposTemplates" [value]="item.id">{{item.value}}</option>
                                        
                                    </select>
                                </div>
                                <div class="col-lg-12 mt-4">
                                    <input type="text" placeholder="Titulo" class="form-control"  formControlName="title">
                                </div>
                                
    
                            </div>
                        </div>
    
                        <div class="mt-4 col-12">
                            <ckeditor [editor]="Editor"  formControlName="template" >
                            </ckeditor>
    
                        </div>
                    </form>
                   
                    <div class="alert alert-primary" role="alert" *ngIf="statusRes">
                       Se actualizo correctamente
                    </div>

                    <div class="alert alert-danger" role="alert" *ngIf="statuserror">
                        No se pudo actualizo correctamente
                      </div>


                    <div class="btn-container">
                        <button class="btn btn-primary" style="width: 100%;" (click)="updateTemplaet()" *ngIf="!showSpiner">Guardar</button>
                        <div class="spinner-border" role="status" *ngIf="showSpiner">
                          </div>

                    </div>

                    <div class="btn-container mt-2">
                        <button class="btn btn-warning mt-3" style="width: 100%;" (click)="editTemplate= false">Cancelar</button>

                    </div>

                </div>

            </div>
        </div>

    </div>
</div>


<p-dialog header="Elige a tus destinatarios" [(visible)]="displayMaximizable" [modal]="true" [style]="{width: '90%'}" [maximizable]="true" [baseZIndex]="10000" *ngIf="displayMaximizable"
    [draggable]="false" [resizable]="false">
    
    <div class="mt-3" *ngIf="tipoTemplate != 3">
        <h3 class="text-right">Campers</h3>
      <div class="col-12">
        <div class="left mb-2">
          <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
          placeholder="Global Search" />
        </div>
        <div class=" scroll-y">
        <p-table #dt [(selection)]="selectdestinatariosCampers"   [rowHover]="true" [rows]="10" [value]="destinatariosCampers"
        [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [paginator]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
        [globalFilterFields]="['tutor_full_name','tutor_email']">
    
        <ng-template pTemplate="header">
          <tr>
           
    
           <th>
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
           </th>
            <th pSortableColumn="tutor_full_name" class="camp">
              <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                Nombre
                <p-sortIcon field="tutor_full_name"></p-sortIcon>
              </div>
             
            </th>
            <th>
                <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                    Titular de la cuenta
                    <p-sortIcon field="tutor_email"></p-sortIcon>
                  </div>
            </th>
            
    
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-customer>
          <tr class="p-selectable-row">
           <td>
            <p-tableCheckbox [value]="customer"></p-tableCheckbox>

           </td>
            <td>
              {{customer.camper_full_name}}
            </td>
            <td>
                {{customer.tutor_email}}
              </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
    
        </ng-template>
      </p-table>
      </div>
      </div>
    </div>

    <div class=" mt-3" *ngIf="tipoTemplate != 3">
        <h3 class="text-right">Staff</h3>
      <div class="col-12">
        <div class="left mb-2">
          <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
          placeholder="Global Search" />
        </div>
        <div class=" scroll-y">
        <p-table #dt [(selection)]="selectdestinatariosStaff"   [rowHover]="true" [rows]="10" [value]="destinatariosStaff"
        [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [paginator]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
        [globalFilterFields]="['staff_full_name','staff_email']">
    
        <ng-template pTemplate="header">
          <tr>
           
    
           <th>
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
           </th>
            <th pSortableColumn="tutor_full_name" class="camp">
              <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                Nombre
                <p-sortIcon field="staff_full_name"></p-sortIcon>
              </div>
             
            </th>
            <th>
                <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                    Titular de la cuenta
                    <p-sortIcon field="staff_email"></p-sortIcon>
                  </div>
            </th>
            
    
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-customer>
          <tr class="p-selectable-row">
           <td>
            <p-tableCheckbox [value]="customer"></p-tableCheckbox>

           </td>
            <td>
              {{customer.staff_full_name}}
            </td>
            <td>
                {{customer.staff_email}}
              </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
    
        </ng-template>
      </p-table>
      </div>
      </div>
    </div>

    <div class=" mt-3" *ngIf="tipoTemplate != 3">
        <h3 class="text-right">Escuela</h3>
      <div class="col-12">
        <div class="left mb-2">
          <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
          placeholder="Global Search" />
        </div>
        <div class=" scroll-y">
        <p-table #dt [(selection)]="selectdestinatariosEscuela" dataKey="school_id"  [rowHover]="true" [rows]="10" [value]="destinatariosEscuela"
        [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [paginator]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
        [globalFilterFields]="['school_email','school']">
    
        <ng-template pTemplate="header">
          <tr>
           
    
           <th>
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
           </th>
            <th pSortableColumn="tutor_full_name" class="camp">
              <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                Nombre
                <p-sortIcon field="school"></p-sortIcon>
              </div>
             
            </th>
            <th>
                <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                    Email
                    <p-sortIcon field="school_email"></p-sortIcon>
                  </div>
            </th>
            
    
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-customer>
          <tr class="p-selectable-row">
           <td>
            <p-tableCheckbox [value]="customer"></p-tableCheckbox>

           </td>
            <td>
              {{customer.name}}
            </td>
            <td>
                {{customer.email}}
              </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
    
        </ng-template>
      </p-table>
      </div>
      </div>
    </div>
    <div *ngIf="tipoTemplate == 3">
      

        <p-tabView>
            <p-tabPanel [header]="item.camp.name" *ngFor="let item of dataResGmail; let i = index" [selected]="i == 0">
                <div class="mt-3" >
                    <h3 class="text-right">Campers</h3>
                  <div class="col-12">
                    <div class="left mb-2">
                      <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
                      placeholder="Global Search" />
                    </div>
                    <div class=" scroll-y">
                    <p-table #dt [(selection)]="item.camp.camperSelect"   [rowHover]="true" [rows]="10" [value]="item.camp.campers"
                    [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [paginator]="true"
                    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
                    [globalFilterFields]="['tutor_full_name','tutor_email']">
                
                    <ng-template pTemplate="header">
                      <tr>
                       
                
                       <th>
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                       </th>
                        <th pSortableColumn="tutor_full_name" class="camp">
                          <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                            Nombre
                            <p-sortIcon field="tutor_full_name"></p-sortIcon>
                          </div>
                         
                        </th>
                        <th>
                            <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                                Titular de la cuenta
                                <p-sortIcon field="tutor_email"></p-sortIcon>
                              </div>
                        </th>
                        
                
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-customer>
                      <tr class="p-selectable-row">
                       <td>
                        <p-tableCheckbox [value]="customer"></p-tableCheckbox>
            
                       </td>
                        <td>
                          {{customer.camper_full_name}}
                        </td>
                        <td>
                            {{customer.tutor_email}}
                          </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                
                    </ng-template>
                  </p-table>
                  </div>
                  </div>
                </div>
            
                <div class=" mt-3" >
                    <h3 class="text-right">Staff</h3>
                  <div class="col-12">
                    <div class="left mb-2">
                      <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
                      placeholder="Global Search" />
                    </div>
                    <div class=" scroll-y">
                    <p-table #dt [(selection)]="item.camp.staffSelect"   [rowHover]="true" [rows]="10" [value]="item.camp.staff"
                    [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [paginator]="true"
                    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
                    [globalFilterFields]="['staff_full_name','staff_email']">
                
                    <ng-template pTemplate="header">
                      <tr>
                       
                
                       <th>
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                       </th>
                        <th pSortableColumn="tutor_full_name" class="camp">
                          <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                            Nombre
                            <p-sortIcon field="staff_full_name"></p-sortIcon>
                          </div>
                         
                        </th>
                        <th>
                            <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                                Titular de la cuenta
                                <p-sortIcon field="staff_email"></p-sortIcon>
                              </div>
                        </th>
                        
                
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-customer>
                      <tr class="p-selectable-row">
                       <td>
                        <p-tableCheckbox [value]="customer"></p-tableCheckbox>
            
                       </td>
                        <td>
                          {{customer.staff_full_name}}
                        </td>
                        <td>
                            {{customer.staff_email}}
                          </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                
                    </ng-template>
                  </p-table>
                  </div>
                  </div>
                </div>
            
                <div class=" mt-3" >
                    <h3 class="text-right">Escuela</h3>
                  <div class="col-12">
                    <div class="left mb-2">
                      <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
                      placeholder="Global Search" />
                    </div>
                    <div class=" scroll-y">
                    <p-table #dt [(selection)]="item.camp.schollSelect" dataKey="school_id"  [rowHover]="true" [rows]="10" [value]="item.camp.schollList"
                    [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [paginator]="true"
                    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
                    [globalFilterFields]="['school_email','school']">
                
                    <ng-template pTemplate="header">
                      <tr>
                       
                
                       <th>
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                       </th>
                        <th pSortableColumn="tutor_full_name" class="camp">
                          <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                            Nombre
                            <p-sortIcon field="school"></p-sortIcon>
                          </div>
                         
                        </th>
                        <th>
                            <div class="flex justify-content-between align-items-center" style=" width: 60%;">
                                Email
                                <p-sortIcon field="school_email"></p-sortIcon>
                              </div>
                        </th>
                        
                
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-customer>
                      <tr class="p-selectable-row">
                       <td>
                        <p-tableCheckbox [value]="customer"></p-tableCheckbox>
            
                       </td>
                        <td>
                          {{customer.name}}
                        </td>
                        <td>
                            {{customer.email}}
                          </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                
                    </ng-template>
                  </p-table>
                  </div>
                  </div>
                </div>
            </p-tabPanel>
        </p-tabView>
    </div>
  
    
     
</p-dialog>